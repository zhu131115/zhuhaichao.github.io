<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>朱海潮网</title>
	</head>
	<body>
		<h1>欢迎</h1>
		<p>在此声明本站基于github的网站功能</p>
		<p>你们可以在这说点什么</p>
		<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #messageInput { width: 300px; height: 60px; }
        .message { border-bottom: 1px solid #eee; padding: 10px 0; }
    </style>
	
</head>
<body>
	          
    <script>
        // ！！！替换成你自己的 URL 和 Key ！！！
        const supabaseUrl = 'https://vtjzurdlpduvfeqkbfrg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0anp1cmRscGR1dmZlcWtiZnJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1MzI3MTQsImV4cCI6MjA3MjEwODcxNH0.0rMc8_xBgK-UYbKn0VA5IlIprTfKyA8aSHXbkwiUazQ';
        // 初始化 Supabase 客户端
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // 加载并显示所有留言
        async function loadMessages() {
            // 从数据库查询 messages 表的所有数据，并按创建时间倒序排列
            let { data: messages, error } = await supabase
                .from('messages')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('获取留言出错:', error);
                return;
            }

            // 将留言显示到网页上
            const messagesContainer = document.getElementById('messages');
            messagesContainer.innerHTML = ''; // 清空容器

            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                // 格式化一下时间
                const time = new Date(msg.created_at).toLocaleString();
                messageElement.innerHTML = `<strong>${msg.username}</strong> <span style="color: gray; font-size: 0.8em;">(${time})</span>:<br>${msg.content}`;
                messagesContainer.appendChild(messageElement);
            });
        }

        // 发送新留言
        async function sendMessage() {
            const username = document.getElementById('nameInput').value;
            const content = document.getElementById('messageInput').value;

            if (!username || !content) {
                alert('请填写名字和留言内容！');
                return;
            }

            // 插入数据到数据库
            const { data, error } = await supabase
                .from('messages')
                .insert([{ username: username, content: content }]);

            if (error) {
                console.error('发送留言出错:', error);
                alert('发送失败！');
            } else {
                console.log('留言发送成功！', data);
                // 清空输入框
                document.getElementById('nameInput').value = '';
                document.getElementById('messageInput').value = '';
                // 重新加载留言列表
                loadMessages();
            }
        }

        // 页面加载时自动获取留言
        loadMessages();
    </script>
	</body>
</html>
